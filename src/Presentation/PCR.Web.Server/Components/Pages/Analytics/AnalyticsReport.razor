@page "/analytics"

<h1 class="text-2xl font-bold text-gray-800 mb-6">@L["Analytics_Title"]</h1>

<div class="bg-white rounded-lg shadow-md p-4 mb-6 flex items-center gap-4">
    <div class="flex items-center gap-2">
        <label for="period-select-mwh" class="text-sm font-medium text-gray-700">@L["Analytics_CompareMonths"]</label>
        <select @bind="selectedPeriod" @bind:after="UpdateData" class="border border-gray-300 rounded-md px-3 py-1 text-sm focus:ring-blue-500 focus:border-blue-500">
            <option value="3">@L["Analytics_Last3Months"]</option>
            <option value="6">@L["Analytics_Last6Months"]</option>
            <option value="12">@L["Analytics_Last12Months"]</option>
        </select>
    </div>
</div>

<div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <div class="lg:col-span-2">
		<AnalyticsBarChart Data="monthlyData" Period="selectedPeriod" />
    </div>

    <div>
		<AnalyticsDonutChart Data="clientData" Period="selectedPeriod" />
    </div>
</div>

@code {
    private int selectedPeriod = 3;

    // Datos para los gr치ficos
    private List<AnalyticsBarChart.MonthlyDataDto> monthlyData = new();
    private List<AnalyticsDonutChart.ClientDataDto> clientData = new();

    // Datos hist칩ricos de MWh para Analytics
    private List<AnalyticsDataDto> fullAnalyticsData = new List<AnalyticsDataDto>
    {
        new AnalyticsDataDto { Month = "Jul 2024", C1 = 1500, C2 = 800, C3 = 3500, C4 = 1000, Total = 6800 },
        new AnalyticsDataDto { Month = "Ago 2024", C1 = 1800, C2 = 900, C3 = 4000, C4 = 1100, Total = 7800 },
        new AnalyticsDataDto { Month = "Sep 2024", C1 = 2000, C2 = 1000, C3 = 4200, C4 = 1300, Total = 8500 },
        new AnalyticsDataDto { Month = "Oct 2024", C1 = 2200, C2 = 1100, C3 = 4400, C4 = 1400, Total = 9100 },
        new AnalyticsDataDto { Month = "Nov 2024", C1 = 2150, C2 = 1150, C3 = 4450, C4 = 1450, Total = 9200 },
        new AnalyticsDataDto { Month = "Dic 2024", C1 = 2100, C2 = 1200, C3 = 4500, C4 = 1500, Total = 9300 },
        new AnalyticsDataDto { Month = "Ene 2025", C1 = 2000, C2 = 1300, C3 = 4600, C4 = 1600, Total = 9500 },
        new AnalyticsDataDto { Month = "Feb 2025", C1 = 1900, C2 = 1400, C3 = 4700, C4 = 1700, Total = 9700 },
        new AnalyticsDataDto { Month = "Mar 2025", C1 = 2100, C2 = 1500, C3 = 4800, C4 = 1800, Total = 10200 },
        new AnalyticsDataDto { Month = "Abr 2025", C1 = 2200, C2 = 1600, C3 = 4900, C4 = 1900, Total = 10600 },
        new AnalyticsDataDto { Month = "May 2025", C1 = 2300, C2 = 1700, C3 = 5000, C4 = 2000, Total = 11000 },
        new AnalyticsDataDto { Month = "Jun 2025", C1 = 2400, C2 = 1800, C3 = 5100, C4 = 2100, Total = 11400 }
    };

    protected override void OnInitialized()
    {
        UpdateData();
    }

    private void UpdateData()
    {
        var slicedData = fullAnalyticsData.TakeLast(selectedPeriod).ToList();

        // Actualizar datos mensuales para el gr치fico de barras (con datos por cliente)
        monthlyData = slicedData.Select(d => new AnalyticsBarChart.MonthlyDataDto
        {
            Month = d.Month,
            Total = d.Total
        }).ToList();

        // Calcular totales por cliente para el gr치fico de dona
        clientData = new List<AnalyticsDonutChart.ClientDataDto>
        {
            new() { ClientName = "Cliente 1", Total = slicedData.Sum(d => d.C1) },
            new() { ClientName = "Cliente 2", Total = slicedData.Sum(d => d.C2) },
            new() { ClientName = "Cliente 3", Total = slicedData.Sum(d => d.C3) },
            new() { ClientName = "Cliente 4", Total = slicedData.Sum(d => d.C4) }
        };
    }

    public class AnalyticsDataDto
    {
        public string Month { get; set; } = string.Empty;
        public int C1 { get; set; }
        public int C2 { get; set; }
        public int C3 { get; set; }
        public int C4 { get; set; }
        public int Total { get; set; }
    }
}
